# -*- coding: utf-8 -*-
"""Parsing_Clar.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1wnLrHL4QoqPZqw0CcsvLDCN1DiKh9ECL
"""

class parsing_clar_():
  
  
  # Author: Samuel Yu <samueltoyu@gmail.com>

  
  
  def __init__(self):
    '''將json 轉成 table'''

    file_name = 'claroty_ICS_Results.json'

    import pandas as pd
    import numpy as np

    import json
      
    # Opening JSON file
    f = open('/content/drive/My Drive/mitre_json/' + file_name,)
      
    # returns JSON object as 
    # a dictionary
    data = json.load(f)
      
    # Iterating through the json
    # list
      
    # Closing file
    f.close()


    list_of_tuples = []

    list_of_tuples = []

    for j in range(0,25):
      for i in data['Adversaries'][0]['Detections_By_Step']['Scenario_1']['Steps'][j]['Substeps']:
        
        Substep = i['Substep']
        Procedure = i['Procedure']
        Criteria = i['Criteria']  #description
        Tactic_Id = i['Tactic']['Tactic_Id']
        Tactic_Name = i['Tactic']['Tactic_Name']
        Technique_Id = i['Technique']['Technique_Id']
        Technique_Name = i['Technique']['Technique_Name']
        Subtechnique_Id = i['Subtechnique']['Subtechnique_Id']
        Subtechnique_Name = i['Subtechnique']['Subtechnique_Name']
        #Detection_Note = i['Detections'][0]['Detection_Note']
        #Detection_Type = i['Detections'][0]['Detection_Type']
        Modifier = i['Detections'][0]['Modifier']
        Screenshots = i['Detections'][0]['Screenshots']
        Footnotes = i['Detections'][0]['Footnotes']

        #list_of_tuples.append((Substep, Procedure, Tactic_Id, Tactic_Name, Technique_Id, Technique_Name, Subtechnique_Id, Subtechnique_Name, Detection_Type, str(Modifier), Screenshots, Footnotes)) #modifier 去list
        
        Detections = []
        for j in range(len(i['Detections'])):
            
            per_Detection = i['Detections'][j]['Detection_Type']
            Detections.append(per_Detection)
                
        Detection_Type = Detections
        
        list_of_tuples.append((Substep, Procedure, Tactic_Id, Tactic_Name, Technique_Id, Technique_Name, Subtechnique_Id, Subtechnique_Name, Detection_Type, str(Modifier), Screenshots, Footnotes)) #modifier 去list
                
        
        
        
        
    columns_name = list(('Substep', 'Procedure', 'Tactic_Id', 'Tactic_Name', 'Technique_Id', 'Technique_Name', 'Subtechnique_Id', 'Subtechnique_Name',  'Detection_Type', 'Modifier' ,'Screenshots', 'Footnotes'))

    df = pd.DataFrame(list_of_tuples, columns = columns_name)


    self.df = df